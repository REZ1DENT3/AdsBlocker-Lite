/**
 *  @author REZ1DENT3, Babichev Maxim
 *  @site https://babichev.net
 *  @year 2013 - 2016
 *  @version 0.213
 */
Array.prototype.diff=function(a){return this.filter(function(i){return a.indexOf(i)<0})};Array.prototype.unique=function(){var ko={};this.forEach(function(item){ko[item]=1});return Object.keys(ko)};Array.prototype.remove=function(item){this.splice(this.indexOf(item),1)};Object.prototype.findKey=function(key){keys=[];keys=Object.keys(this).filter(function(ind){return(new RegExp(ind)).test(key)});result=[];for(var i=0;i<keys.length;++i){result=result.concat(this[keys[i]])}
return result};Array.prototype.contains=function(item){return(this.indexOf(item)!=-1)};function map(map,obj){obj=obj||this;for(var k in map){obj[k]=obj[map[k]]}}
function clone(obj){return JSON.parse(JSON.stringify(obj))}
function now(){return Math.floor((new Date()).getTime()/1000)}
function addScript(template){var script=document.createElement("script");if(template.src){script.src=template.src}
if(template.textContent){script.textContent=template.textContent}
document.documentElement.appendChild(script)}
var jsExtended=new(function(){this.expr=new Array();this.expr[":attr"]=function(d,sel,selector){return Array.prototype.slice.call(document.querySelectorAll(sel)).filter(function(element){keys=Array.prototype.slice.call(element.attributes).filter(function(attribute){return(new RegExp(selector)).test(attribute.name)});return keys.length})};this.expr[":removeAll"]=function(d,sel,selector){return d.querySelectorAll(sel)}})();function querySelectorAll(d,selector){for(var expr in jsExtended.expr){if(typeof expr=="undefined")break;regex=new RegExp(expr+'(.*?)$');if(regex.test(selector)){newSelector=selector.match(regex);newSelector[0]=selector.substr(0,selector.indexOf(expr));return jsExtended.expr[expr](d,newSelector[0],newSelector[1])}}
return d.querySelectorAll(selector)};var blockerRulesCount=0;var hostname=window.document.domain;if(hostname.substr(0,4)=='www.'){hostname=hostname.substr(4)}
var rules=new Array();var rulesExpr=new Array();var isNotWhitelist=!0;const ConstAllSite='___AllSite___';function adsBlock(e){for(ind=0;ind<e.length;++ind){if(typeof e[ind].parentNode!="undefined"&&e[ind].parentNode!=null){if(typeof e[ind].parentNode.removeChild!="undefined"){e[ind].parentNode.removeChild(e[ind])}}}}
function blocker(d){if(!isNotWhitelist){return this}
if(rules.length){qsRules=d.querySelectorAll(rules.join(', '));blockerRulesCount+=qsRules.length;if(qsRules.length){adsBlock(qsRules)}}
if(rulesExpr.length){for(i=0;i<rulesExpr.length;++i){qsRulesExpr=querySelectorAll(d,rulesExpr[i]);blockerRulesCount+=qsRulesExpr.length;if(qsRulesExpr.length){adsBlock(qsRulesExpr)}}}
if(blockerRulesCount){chrome.runtime.sendMessage({name:"setBadgeText",text:''+blockerRulesCount})}
return this};chrome.storage.local.get({rulesData:[],whitelisted:[]},function(items){rules=[];rulesExpr=[];_rules=[];if(typeof items.rulesData.findKey!='undefined'){_rules=items.rulesData.findKey(hostname)}
if(typeof items.rulesData[ConstAllSite]!='undefined'){_rules=_rules.concat(items.rulesData[ConstAllSite])}
if(typeof items.rulesData['^'+hostname]!='undefined'){_rules=_rules.diff(items.rulesData['not:'+hostname])}
for(var i=0;i<_rules.length;++i){var isExpr=!1;for(var expr in jsExtended.expr){if(isExpr||typeof expr=="undefined")break;regex=new RegExp(expr+'(.*?)$');isExpr=regex.test(_rules[i]);}
if(isExpr){rulesExpr.push(_rules[i])}
else{rules.push(_rules[i])}}
isNotWhitelist=items.whitelisted.indexOf(hostname)<0;document.addEventListener('DOMSubtreeModified',function(mutationEvent){blocker(mutationEvent.target)},!1)});function inject(){var originalOpenWndFnKey="originalOpenFunction";var originalWindowOpenFn=window.open,originalCreateElementFn=document.createElement,originalCreateEventFn=document.createEvent,windowsWithNames={};var timeSinceCreateAElement=0;var lastCreatedAElement=null;var fullScreenOpenTime;var parentOrigin=(window.location!=window.parent.location)?document.referrer:document.location;window[originalOpenWndFnKey]=window.open;function newWindowOpenFn(){var openWndArguments=arguments,useOriginalOpenWnd=!0,generatedWindow=null;function blockedWndNotification(openWndArguments){parent.postMessage({type:"blockedWindow",args:JSON.stringify(openWndArguments)},parentOrigin)}
function getWindowName(openWndArguments){var windowName=openWndArguments[1];if((windowName!=null)&&(["_blank","_parent","_self","_top"].indexOf(windowName)<0)){return windowName}
return null}
function copyMissingProperties(src,dest){var prop;for(prop in src){try{if(dest[prop]===undefined){dest[prop]=src[prop]}}catch(e){}}
return dest}
var capturingElement=null;if(window.event!=null){capturingElement=window.event.currentTarget}
if(capturingElement==null){var caller=openWndArguments.callee;while((caller.arguments!=null)&&(caller.arguments.callee.caller!=null)){caller=caller.arguments.callee.caller}
if((caller.arguments!=null)&&(caller.arguments.length>0)&&(caller.arguments[0].currentTarget!=null)){capturingElement=caller.arguments[0].currentTarget}}
if((capturingElement!=null)&&((capturingElement instanceof Window)||(capturingElement===document)||((capturingElement.URL!=null)&&(capturingElement.body!=null))||((capturingElement.nodeName!=null)&&((capturingElement.nodeName.toLowerCase()=="body")||(capturingElement.nodeName.toLowerCase()=="#document"))))){window.pbreason="Blocked a new window opened with URL: "+openWndArguments[0]+" because it was triggered by the "+capturingElement.nodeName+" element";useOriginalOpenWnd=!1}else{useOriginalOpenWnd=!0}
var fullScreenElement=document.webkitFullscreenElement||document.mozFullscreenElement||document.fullscreenElement
if((((new Date()).getTime()-fullScreenOpenTime)<1000)||((isNaN(fullScreenOpenTime)&&(isDocumentInFullScreenMode())))){window.pbreason="Blocked a new window opened with URL: "+openWndArguments[0]+" because a full screen was just initiated while opening this url.";if(document.exitFullscreen){document.exitFullscreen()}
else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}
else if(document.webkitCancelFullScreen){document.webkitCancelFullScreen()}
useOriginalOpenWnd=!1}
if(useOriginalOpenWnd==!0){generatedWindow=originalWindowOpenFn.apply(this,openWndArguments);var windowName=getWindowName(openWndArguments);if(windowName!=null){windowsWithNames[windowName]=generatedWindow}
if(generatedWindow!==window){var openTime=(new Date()).getTime();var originalWndBlurFn=generatedWindow.blur;generatedWindow.blur=function(){if(((new Date()).getTime()-openTime)<1000){window.pbreason="Blocked a new window opened with URL: "+openWndArguments[0]+" because a it was blured";generatedWindow.close();blockedWndNotification(openWndArguments)}else{originalWndBlurFn()}}}}else{var location={href:openWndArguments[0]};location.replace=function(url){location.href=url};generatedWindow={close:function(){return !0},test:function(){return !0},blur:function(){return !0},focus:function(){return !0},showModelessDialog:function(){return !0},showModalDialog:function(){return !0},prompt:function(){return !0},confirm:function(){return !0},alert:function(){return !0},moveTo:function(){return !0},moveBy:function(){return !0},resizeTo:function(){return !0},resizeBy:function(){return !0},scrollBy:function(){return !0},scrollTo:function(){return !0},getSelection:function(){return !0},onunload:function(){return !0},print:function(){return !0},open:function(){return this},opener:window,closed:!1,innerHeight:480,innerWidth:640,name:openWndArguments[1],location:location,document:{location:location}};copyMissingProperties(window,generatedWindow);generatedWindow.window=generatedWindow;var windowName=getWindowName(openWndArguments);if(windowName!=null){try{windowsWithNames[windowName].close()}catch(err){}}
setTimeout(function(){var url;if(!(generatedWindow.location instanceof Object)){url=generatedWindow.location}else if(!(generatedWindow.document.location instanceof Object)){url=generatedWindow.document.location}else if(location.href!=null){url=location.href}else{url=openWndArguments[0]}
openWndArguments[0]=url;blockedWndNotification(openWndArguments)},100)}
return generatedWindow}
window.open=function(){try{return newWindowOpenFn.apply(this,arguments)}catch(err){return null}};document.createElement=function(){var newElement=originalCreateElementFn.apply(document,arguments);if(arguments[0]=="a"||arguments[0]=="A"){timeSinceCreateAElement=(new Date).getTime();var originalDispatchEventFn=newElement.dispatchEvent;newElement.dispatchEvent=function(event){if(event.type!=null&&((""+event.type).toLocaleLowerCase()=="click")){window.pbreason="blocked due to an explicit dispatchEvent event with type 'click' on an 'a' tag";parent.postMessage({type:"blockedWindow",args:JSON.stringify({"0":newElement.href})},parentOrigin);return !0}
return originalDispatchEventFn(event)};lastCreatedAElement=newElement}
return newElement};document.createEvent=function(){try{if((arguments[0].toLowerCase().indexOf("mouse")>=0)&&((new Date).getTime()-timeSinceCreateAElement)<=50){window.pbreason="Blocked because 'a' element was recently created and "+arguments[0]+" event was created shortly after";arguments[0]=lastCreatedAElement.href;parent.postMessage({type:"blockedWindow",args:JSON.stringify({"0":lastCreatedAElement.href})},parentOrigin);return null}
return originalCreateEventFn.apply(document,arguments)}catch(err){}};function onFullScreen(isInFullScreenMode){if(isInFullScreenMode){fullScreenOpenTime=(new Date()).getTime()}else{fullScreenOpenTime=NaN}}
function isDocumentInFullScreenMode(){return((document.fullScreenElement&&document.fullScreenElement!==null)||((document.mozFullscreenElement!=null)||(document.webkitFullscreenElement!=null)))}
document.addEventListener("fullscreenchange",function(){onFullScreen(document.fullscreen)},!1);document.addEventListener("mozfullscreenchange",function(){onFullScreen(document.mozFullScreen)},!1);document.addEventListener("webkitfullscreenchange",function(){onFullScreen(document.webkitIsFullScreen)},!1)};function monitorBlocks(){window.addEventListener("message",function receiveMessage(event){if(event.data.type&&(event.data.type=="blockedWindow")){blockerRulesCount++;chrome.runtime.sendMessage({name:"trackEvent",action:"PopupBlocked",label:hostname})}},!1)}
addScript({textContent:inject.toString()+" inject()"});monitorBlocks();'use strict';var isOpera=!!window.opera||navigator.userAgent.indexOf(' OPR/')>=0;var isChrome=!!window.chrome&&!isOpera;var player=document.querySelector('#player');function skipVideoAd(){if(document.getElementsByClassName('videoAdUi').length>0){document.getElementsByClassName('video-stream html5-main-video')[0].src='';blockerRulesCount++}}
function hideOverlayAd(){}
function clearAds(){skipVideoAd();hideOverlayAd()}
function DOMSTlistener(e){if(e.target.innerHTML.length>0){clearAds()}}
function init(){var videoAdContainer=document.getElementsByClassName('video-ads')[0];if(videoAdContainer){player.removeEventListener('DOMSubtreeModified',init);videoAdContainer.addEventListener('DOMSubtreeModified',DOMSTlistener)}}
if(/https?:\/\/(\w*.)?youtube.com/i.test(window.location.href.toLowerCase())){if(isChrome){player.addEventListener('DOMSubtreeModified',init)}else{clearAds()}}